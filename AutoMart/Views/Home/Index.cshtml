@using AutoMart.DataAccess;
@{
    ViewData["Title"] = "AutoMart";
}

@section TopNavBar {
    <form class="form-inline">
        <select class="custom-select form-control-lg mr-sm-2" id="select-categoria">
            <option selected>Seleccione una categoria...</option>
            @foreach (Categoria c in ViewBag.categorias)
            {
                <option value="@c.IDCategoria">@c.Descripcion</option>
            }
            <option value="-1">Todos</option>
        </select>
        <input class="form-control form-control-lg mr-sm-2" type="search" placeholder="Buscar" aria-label="Buscar">
        <button class="btn btn-lg btn-outline-light my-2 my-sm-0" type="submit">Buscar</button>
    </form>
}

<div id="template-card" style="display: none;">
    <div class="card">
        <img class="card-img-top" src="~/images/untitled.png" alt="Card image cap">
        <div class="card-body">
            <h5 class="card-title"></h5>
            <p class="card-text">$</p>
        </div>
    </div>
</div>

<div id="template-card-blank" style="display: none;">
    <div class="card">
        <img class="card-img-top" src="" alt="">
        <div class="card-body">
            <h5 class="card-title"></h5>
            <p class="card-text"></p>
        </div>
    </div>
</div>
<div id="content-cards">
</div>

<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
        <li class="page-item">
            <a class="page-link" href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
            </a>
        </li>
        <li class="page-item"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
            <a class="page-link" href="#" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
            </a>
        </li>

    </ul>
</nav>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $('#select-categoria').on('change', function () {
                var IdCategoria = $(this).val();
                $('#content-cards').html('');

                $.getJSON("/Home/ObtenerProductosPorCategoria?categoria=" + IdCategoria, function (data) {
                    var len = data.length;
                    var rows = Math.ceil(len / 5);
                    console.log("Productos por categoria ->", len, "filas ->", rows);

                    var t = 0;
                    for (var j = 0; j < len; j++) {
                        console.log(t, j);
                        var el = $('#template-card > .card').clone();

                        if (t === 0) {
                            var cardGroup = $('<div class="card-group"></div>');
                            $('#content-cards').append(cardGroup);
                        }

                        el.attr('IdProducto', data[j].idProducto);
                        el.find('.card-title').append(data[j].nombre);
                        el.find('.card-text').append(data[j].precio);

                        cardGroup.append(el);

                        if (j === len - 1) {
                            console.log('j === len-1, t ->', t);
                            if (t <= 4) {
                                var restante = 4 - t;
                                console.log('t <= 4, r ->', restante);
                                for (var r = 0; r < restante; r++) {
                                    var elBlank = $('#template-card-blank > .card').clone();
                                    cardGroup.append(elBlank);
                                }
                            }
                        }

                        t++;

                        if (t >= 5) {
                            t = 0;
                        }
                    }
                });
            });
        });
    </script>
}